/*
    Dual licensed under MIT and GPL
*/
(function(t){var u="ontouchstart"in window,x="drag",k=function(){var a={},b=u?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},d=[],l=function(b,a){for(var c=0,f=d.length;c<f;c++)if(d[c]&&d[c].element===b&&d[c].anchor===a)return!0;return!1},c=function(b,a,c){d[b._id]&&d[b._id].events[a]&&c(d[b._id].events[a])},v=function(b,a){a=a||{};a.element=b;a.anchor=a.anchor||b;a.boundingBox=a.boundingBox||null;a.releaseAnchors=a.releaseAnchors||[];a.releaseAnchors.unshift(document);
return a},h=1,j=function(){this._id=h++};j.prototype.unbind=function(){return k.unbind(this)};j.prototype.bindEvent=function(b,a){return k.bindEvent(this,b,a)};j.prototype.unbindEvent=function(b,a){return k.unbindEvent(this,b,a)};j.prototype.invokeEvent=function(b,a){return k.invokeEvent(this,b,a)};j.prototype.setBoundingBox=function(b){d[this._id].boundingBox=b};a.bind=function(a,c){c=v(a,c);if(!(c.element&&"object"===typeof c.element))throw Error("Must give an element to drag");if("static"===r(c.element,
"position"))throw Error("Cannot drag-drop an element with position:static");if(!l(c.element,c.anchor)){var h=new j,f={element:c.element,anchor:c.anchor,releaseAnchors:c.releaseAnchors,dragging:!1,event:null,shouldUnbind:!1,boundingBox:c.boundingBox,events:{beforedrag:g(c.beforedrag),dragstart:g(c.dragstart),dragend:g(c.dragend),drag:g(c.drag),unbind:g(c.unbind)}};f.event=p.bind(f.anchor,b.start,function(a){function c(a){return function(b){for(var c=0,d=h.length;c<d;c++)p.unbind(h[c]);f.dragging=!1;
y(f.element,x);f.shouldUnbind&&k.unbind(f.element,f.anchor);f.events.dragend.call(f.element,new q("dragend",b,f,{releaseAnchor:a}));return s(b)}}if(window.event&&1===a.button||0===a.button||u){s(a);f.events.beforedrag.call(f.element,new q("beforedrag",a,f));f.dragging=!0;B(f.element,x);var d=z(f.element,"left"),l=z(f.element,"top"),A=f.element.offsetLeft,v=f.element.offsetTop,j=C(f.element),h=[];h.push(p.bind(u?f.anchor:document,b.move,function(b){var c=f.element.offsetWidth,h=f.element.offsetHeight,
o=d+(b.clientX-a.clientX),k=l+(b.clientY-a.clientY);if(f.boundingBox){var i=f.boundingBox,g,m,n;"offsetParent"===i?(i=f.element.offsetParent,"relative"===r(f.element,"position")?(g=-A,n=-v):g=n=0,m=i.clientWidth+g,i=i.clientHeight+n):"windowSize"===i?(m=window.innerWidth||document.documentElement.clientWidth||body().clientWidth,i=window.innerHeight||document.documentElement.clientHeight||body().clientHeight,"relative"===r(f.element,"position")?(g=-j.x,n=-j.y):g=n=0,m+=g,i+=n):(g=i.x.min,m=i.x.max,
n=i.y.min,i=i.y.max);o=Math.max(g,Math.min(m-c,o));k=Math.max(n,Math.min(i-h,k))}f.element.style.left=o+"px";f.element.style.top=k+"px";f.events.drag.call(f.element,new q("drag",b,f));return s(b)}));for(var o=0,m=f.releaseAnchors.length;o<m;o++){var g=f.releaseAnchors[o];h.push(p.bind(g,b.end,c(g)))}document.body.focus();h.push(p.bind(document,"selectstart",!1));h.push(p.bind(f.anchor,"dragstart",!1));f.events.dragstart.call(f.element,new q("dragstart",a,f));return!1}});d[h._id]=f;return h}};a.unbind=
function(a){if(a instanceof j&&(a=a._id,d[a]))d[a].dragging?d[a].shouldUnbind=!0:(p.unbind(d[a].event),d[a]=null),binding.events.unbind.call(binding.element,new q("unbind",e,binding))};a.bindEvent=function(a,b,d){c(a,b,function(a){a.push(d)})};a.unbindEvent=function(a,b,d){c(a,b,function(a){a.remove(d)})};a.invokeEvent=function(a,b,l){c(a,b,function(c){c.call(d[a._id].element,new q(b,l,a))})};return a}(),z=function(a,b){var d=parseFloat(r(a,b));return isNaN(d)?0:d},r=function(a,b){if(a.currentStyle)return a.currentStyle[b];
if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);if(a.style)return a.style[b]},C=function(a){var b=0,d=0;if(a.offsetParent){do b+=a.offsetLeft,d+=a.offsetTop;while(a=a.offsetParent)}return{x:b,y:d}},s=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();return a.returnValue=!1},w={},y=function(a,b){w[b]||(w[b]=RegExp("(^|\\s)+"+b+"(\\s|$)+"));a.className=a.className.replace(w[b]," ")},B=function(a,b){y(a,b);a.className+=
" "+b},g=function(a){var b=[],d=function(){for(var a,c=0,d=b.length;c<d;c++)a=b[c].apply(this,arguments);return a};d.push=function(){b.push.apply(b,arguments)};d.remove=function(){var a=Array.prototype.slice.call(arguments),c=[],d=0,h=b.length;a:for(;d<h;d++){for(var j=0,g=a.length;j<g;j++)if(b[d]===a[j])continue a;c.push(b[d])}b=c};"function"===typeof a&&b.push(a);return d},q=function(a,b,d,l){this.type=a;this.originalEvent=b;this.altKey=b.altKey||!1;this.ctrlKey=b.ctrlKey||!1;this.shiftKey=b.shiftKey||
!1;this.timestamp=b.timestamp||+new Date;var c=a=0;if(b.targetTouches)a=b.targetTouches[0].pageX,c=b.targetTouches[0].pageY;else if(b.pageX||b.pageY)a=b.pageX,c=b.pageY;else if(b.clientX||b.clientY)a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=b.clientY+document.body.scrollTop+document.documentElement.scrollTop;this.pos={x:a,y:c};this.binding=d;var g;if(b.target)g=b.target;else if(b.srcElement)g=b.srcElement;if(3===g.nodeType)g=g.parentNode;this.target=g;if(l)for(var h in l)l.hasOwnProperty(h)&&
(this[h]=l[h])},p=function(){var a=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){}}(),b=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){}}();return{bind:function(d,g,c){var k=!1===c?function(a){return s(a)}:c,c=function(a){return k.call(d,a||window.event)};a(d,g,c);var h=
function(){b(d,g,c)};h.unbind=function(){h()};return h},unbind:function(a){a()}}}();window.DragDrop=k;t.fn.dragdrop=function(a){var a=a||{},b=[];this.each(function(){var d=t.extend({},a);if("string"===typeof d.anchor)d.anchor=t(d.anchor,this)[0];b.push(k.bind(this,d))});return{unbind:function(){for(var a=0,g=b.length;a<g;a++)k.unbind(b[a])}}}})(jQuery);
